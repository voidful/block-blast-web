<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <title>Block Blast — Flow+ 版</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="styles.css" rel="stylesheet" />
</head>
<body>
  <div class="app" id="app">
    <header class="topbar">
      <div class="title">
        <span class="dot"></span>
        <strong>Block Blast — Flow+ 版</strong>
      </div>
      <div class="scores">
        <div>分數 <b id="score">0</b></div>
        <div>最高分 <b id="best">0</b></div>
      </div>
      <div class="combo">
        <span id="comboTag">COMBO ×1</span>
        <i id="comboBar"></i>
      </div>
      <div class="fever">
        <span>FEVER</span>
        <div class="fever-bar">
          <i id="feverFill" style="--fever:0"></i>
        </div>
      </div>
      <div class="stars-wrap">⭐ <b id="stars">0</b></div>
    </header>

    <nav class="actions">
      <button id="btn-undo">復原 ×3</button>
      <button id="btn-settings">⚙️ 設定</button>
      <button id="btn-daily">每日挑戰</button>
      <button id="btn-hint">提示</button>
      <button id="btn-tutorial">教學</button>
      <button id="btn-share">分享</button>
      <button id="btn-share-img">海報</button>
      <button id="btn-mission">任務</button>
      <button id="btn-new" class="accent">新遊戲</button>
    </nav>

    <main class="content" id="content">
      <!-- 左側：棋盤 -->
      <section id="boardWrap" class="board-wrap">
        <div id="board" class="board">
          <div id="cells" class="cells"></div>
          <!-- 重要：幽靈層 / 曲線畫布都放在 board 裡，避免相對座標漂移 -->
          <div id="ghost"></div>
          <canvas id="fx"></canvas>
        </div>
      </section>

      <!-- 右側：暫存 + 工具 + 托盤 + 說明 -->
      <aside class="side">
        <div class="hold-row">
          <div class="hold-label">暫存（Hold）</div>
          <div id="holdSlot" class="hold-slot">(空)</div>
          <div class="tools">
            <button id="btn-hammer" title="錘子清除一格">🔨</button>
            <button id="btn-shuffle" title="重抽托盤">🔄</button>
          </div>
        </div>

        <div id="tray" class="tray">
          <div class="slot" data-index="0" aria-label="候選 1"></div>
          <div class="slot" data-index="1" aria-label="候選 2"></div>
          <div class="slot" data-index="2" aria-label="候選 3"></div>
        </div>

        <div class="help">
          <p class="muted">
            玩法：拖曳托盤的方塊到棋盤。填滿整列或整行會清除並加分。三個方塊都用完會再補三個。
            若托盤中任一方塊無法放置，便判定失敗。<br/>
            操作：拖曳放置。方向鍵移動，<kbd>Esc</kbd> 取消，<kbd>U</kbd> 復原，<kbd>N</kbd> 新遊戲，<kbd>S</kbd> 設定，<kbd>H</kbd> 熱度提示。
          </p>
        </div>
      </aside>
    </main>
  </div>

  <!-- 遊戲結束 -->
  <section id="overlayGameOver" class="overlay">
    <div class="panel">
      <h2>遊戲結束</h2>
      <p>本局分數：<b id="finalScore">0</b></p>
      <div class="row">
        <button id="btn-again" class="accent">再來一局</button>
        <button id="btn-close">關閉</button>
      </div>
    </div>
  </section>

  <!-- 設定 -->
  <section id="overlaySettings" class="overlay">
    <div class="panel">
      <h2>設定</h2>
      <label><input type="checkbox" id="opt-audio" checked> 啟用音樂／音效</label>
      <label><input type="checkbox" id="opt-midi"> 啟用 WebMIDI（若可用）</label>
      <label><input type="checkbox" id="opt-haptics" checked> 震動回饋</label>
      <label><input type="checkbox" id="opt-reduce"> 降低特效（效能模式）</label>
      <label><input type="checkbox" id="opt-colorblind"> 色盲友善配色</label>
      <label><input type="checkbox" id="opt-contrast"> 提高對比</label>
      <div class="row">
        <button id="btn-close-settings" class="accent">完成</button>
      </div>
    </div>
  </section>

  <!-- 任務 -->
  <section id="overlayMission" class="overlay">
    <div class="panel wide">
      <h2>任務</h2>
      <h3>每日</h3>
      <div id="dailyList" class="mission-list"></div>
      <h3>每週</h3>
      <div id="weeklyList" class="mission-list"></div>
      <div class="row">
        <button id="btn-close-mission" class="accent">關閉</button>
      </div>
    </div>
  </section>

  <!-- Toast + Live Region -->
  <div id="toasts" class="toasts"></div>
  <div id="sr-live" class="sr" aria-live="polite" aria-atomic="true"></div>

  <script src="main.js"></script>
</body>
</html>