<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <title>Block Blast — Flow+ 版</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <header>
      <div class="brand"><span class="dot"></span> Block Blast — Flow+ 版</div>

      <div class="scorebox">
        <div><div class="label">分數</div><div id="score" class="value">0</div></div>
        <div><div class="label">最高分</div><div id="best" class="value">0</div></div>
      </div>

      <div class="combo">
        <div id="comboTag" class="tag">COMBO ×1</div>
        <div class="bar"><i id="comboBar"></i></div>
      </div>

      <div class="fever">
        <div class="fever-label">FEVER</div>
        <div class="fever-bar"><i id="feverFill"></i></div>
      </div>

      <div class="stars">⭐ <b id="stars">0</b></div>

      <div class="controls">
        <button id="btn-undo" class="secondary">復原 ×3</button>
        <button id="btn-settings" class="ghost">⚙️</button>
        <button id="btn-daily" class="secondary">每日挑戰</button>
        <button id="btn-hint" class="secondary">提示</button>
        <button id="btn-tutorial" class="ghost">教學</button>
        <button id="btn-share" class="ghost">分享</button>
        <button id="btn-share-img" class="ghost">🖼️海報</button>
        <button id="btn-pass" class="ghost">🎯 Season</button>
        <button id="btn-mission" class="ghost">📜 任務</button>
        <button id="btn-new">新遊戲</button>
      </div>
    </header>

    <div class="board-wrap" id="boardWrap">
      <div id="board" class="board" aria-label="遊戲棋盤"></div>
      <div id="ghost" class="ghost-layer" aria-hidden="true"></div>
      <canvas id="fx" class="fx-layer"></canvas>
      <div class="toasts" id="toasts"></div>

      <!-- Game Over -->
      <div id="overlayGameOver" class="overlay">
        <div class="dialog">
          <h2>遊戲結束</h2>
          <p>本局分數 <b id="finalScore">0</b>。</p>
          <div style="display:flex; gap:8px; justify-content:center">
            <button id="btn-again">再玩一次</button>
            <button id="btn-close" class="secondary">關閉</button>
          </div>
        </div>
      </div>

      <!-- Settings -->
      <div id="overlaySettings" class="overlay">
        <div class="dialog" style="text-align:left">
          <h2 style="text-align:center">設定</h2>
          <label><input type="checkbox" id="opt-audio" checked /> 啟用音效與音樂</label><br/>
          <label><input type="checkbox" id="opt-haptics" checked /> 啟用震動（行動裝置）</label><br/>
          <label><input type="checkbox" id="opt-reduce" /> 降低動態</label><br/>
          <label><input type="checkbox" id="opt-contrast" /> 高對比模式</label><br/>
          <label><input type="checkbox" id="opt-colorblind" /> 色盲友善調色</label><br/>
          <label><input type="checkbox" id="opt-hint" checked /> 閒置自動提示</label><br/>
          <label><input type="checkbox" id="opt-midi" /> 啟用 MIDI（若可用）</label>
          <div style="margin-top:10px; display:flex; gap:8px; justify-content:center">
            <button id="btn-close-settings" class="secondary">關閉</button>
          </div>
        </div>
      </div>

      <!-- Pass -->
      <div id="overlayPass" class="overlay">
        <div class="dialog" style="text-align:left">
          <h2 style="text-align:center">Season 1：Cosmetic Pass</h2>
          <div id="passList" style="max-height:40vh; overflow:auto"></div>
          <div style="text-align:center; margin-top:10px"><button id="btn-close-pass" class="secondary">關閉</button></div>
        </div>
      </div>

      <!-- Missions -->
      <div id="overlayMission" class="overlay">
        <div class="dialog" style="text-align:left">
          <h2 style="text-align:center">任務</h2>
          <h3>每日</h3><div id="dailyList"></div>
          <h3>每週</h3><div id="weeklyList"></div>
          <div style="text-align:center; margin-top:10px"><button id="btn-close-mission" class="secondary">關閉</button></div>
        </div>
      </div>

      <div id="sr-live" aria-live="polite" style="position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;"></div>
    </div>

    <div class="hold-row">
      <span class="hold-label">暫存（Hold）</span>
      <div id="holdSlot" class="hold-slot"></div>
      <div style="display:flex; gap:8px">
        <button id="btn-hammer" class="secondary" title="錘子：清除一格（花1⭐）">🔨</button>
        <button id="btn-shuffle" class="secondary" title="重抽托盤（花1⭐）">🔄</button>
        <button id="btn-hold" class="secondary" title="暫存格/取出">🧰</button>
      </div>
      <span id="dailyTag" class="label" style="margin-left:auto; display:none"></span>
    </div>

    <div id="tray" class="tray" aria-label="托盤（待放置方塊）">
      <div class="slot" data-index="0"></div>
      <div class="slot" data-index="1"></div>
      <div class="slot" data-index="2"></div>
    </div>

    <div class="help">
      <b>玩法</b>：拖曳托盤中的方塊到棋盤。填滿整列或整行會清除並加分。三個方塊都用完會再補三個。若托盤中任一方塊均無法放置，便判定失敗。<br>
      <b>操作</b>：拖曳放置；或以 <span class="kbd">1/2/3</span> 選塊、<span class="kbd">方向鍵</span> 移動、<span class="kbd">Space/Enter</span> 放置、<span class="kbd">Esc</span> 取消；<span class="kbd">U</span> 復原、<span class="kbd">N</span> 新遊戲、<span class="kbd">S</span> 設定、<span class="kbd">H</span> 熱度提示。
    </div>
  </div>

  <script type="module" src="main.js"></script>
</body>
</html>